  pragma solidity ^0.4.19;
  
  contract BANK_SAFE {
      mapping(address => uint256) public balances;
  
      uint public MinSum;
  
      LogFile Log;
  
      bool intitalized;
  
+     modifier onlyInitialized() {
+         require(intitalized);
+         _;
+     }
+ 
-     function SetMinSum(uint _val) public {
+     function SetMinSum(uint _val) public onlyInitialized {
?                                          ++++++++++++++++
-         if (intitalized) throw;
          MinSum = _val;
      }
  
-     function SetLogFile(address _log) public {
+     function SetLogFile(address _log) public onlyInitialized {
?                                              ++++++++++++++++
-         if (intitalized) throw;
          Log = LogFile(_log);
      }
  
      function Initialized() public {
          intitalized = true;
      }
  
      function Deposit() public payable {
          balances[msg.sender] += msg.value;
          Log.AddMessage(msg.sender, msg.value, "Put");
      }
  
-     function Collect(uint _am) public payable {
?                                       ^ ---
+     function Collect(uint _am) public onlyInitialized {
?                                       ^^^^^^^^^  ++ +
-         if (balances[msg.sender] >= MinSum && balances[msg.sender] >= _am) {
?          ^^                                                               ^^
+         require(balances[msg.sender] >= MinSum && balances[msg.sender] >= _am);
?         ++++ ^^                                                               ^
-             if (msg.sender.call.value(_am)()) {
-                 balances[msg.sender] -= _am;
? --------
+         balances[msg.sender] -= _am;
-                 Log.AddMessage(msg.sender, _am, "Collect");
? --------
+         Log.AddMessage(msg.sender, _am, "Collect");
+         msg.sender.transfer(_am);
-             }
-         }
      }
  
      function() public payable {
          Deposit();
      }
  }
  
  contract LogFile {
      struct Message {
          address Sender;
          string Data;
          uint Val;
          uint Time;
      }
  
      Message[] public History;
  
-     Message LastMsg;
- 
      function AddMessage(address _adr, uint _val, string _data) public {
+         Message memory LastMsg;
          LastMsg.Sender = _adr;
          LastMsg.Time = now;
          LastMsg.Val = _val;
          LastMsg.Data = _data;
          History.push(LastMsg);
      }
- }
+ }