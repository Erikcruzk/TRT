function _checkOnERC721Received(address from, address to, uint256 tokenId, bytes memory _data)
        private returns (bool)
    {
        if (to.isContract()) {
            (bool success, bytes memory returndata) = to.call(abi.encodeWithSelector(
                IERC721Receiver(to).onERC721Received.selector, _msgSender(), from, tokenId, _data
            ));
            if (!success) {
                if (returndata.length > 0) {
                    // Look for revert reason and bubble it up if present
                    assembly {
                        let returndata_size := mload(returndata)
                        revert(add(32, returndata), returndata_size)
                    }
                } else {
                    revert("ERC721: transfer to non ERC721Receiver implementer");
                }
            } else {
                bytes4 retval = abi.decode(returndata, (bytes4));
                return (retval == IERC721Receiver(to).onERC721Received.selector);
            }
        } else {
            return true;
        }
    }