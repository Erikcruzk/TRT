function len(slice self) internal view returns (uint len) {
    var ptr = self._ptr - 31;
    var end = ptr + self._len;
    for (len = 0; ptr < end; len++) {
        uint8 b;
        assembly {
            b := and(mload(ptr), 0xFF)
        }
        if (b < 0x80) {
            ptr += 1;
        } else if(b < 0xE0) {
            ptr += 2;
        } else if(b < 0xF0) {
            ptr += 3;
        } else if(b < 0xF8) {
            ptr += 4;
        } else if(b < 0xFC) {
            ptr += 5;
        } else {
            ptr += 6;
        }
    }
    return len;
}