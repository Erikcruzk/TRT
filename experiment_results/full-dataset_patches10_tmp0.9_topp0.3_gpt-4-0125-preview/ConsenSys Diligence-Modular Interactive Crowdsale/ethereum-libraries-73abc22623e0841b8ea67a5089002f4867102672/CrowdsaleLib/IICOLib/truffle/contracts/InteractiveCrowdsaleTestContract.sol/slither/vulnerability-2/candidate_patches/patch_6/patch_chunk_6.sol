function withdrawBid(InteractiveCrowdsaleStorage storage self) public returns (bool) {
    require(now < self.endWithdrawalTime);
    require(self.personalCaps[msg.sender] > 0);

    uint256 refundWei = self.base.hasContributed[msg.sender];
    self.base.leftoverWei[msg.sender] += refundWei;
    self.base.hasContributed[msg.sender] = 0;

    self.valuationSums[self.personalCaps[msg.sender]] -= refundWei;
    self.numBidsAtValuation[self.personalCaps[msg.sender]] -= 1;
    delete self.personalCaps[msg.sender];

    LogBidWithdrawn(msg.sender, refundWei, self.personalCaps[msg.sender]);
    return true;
}