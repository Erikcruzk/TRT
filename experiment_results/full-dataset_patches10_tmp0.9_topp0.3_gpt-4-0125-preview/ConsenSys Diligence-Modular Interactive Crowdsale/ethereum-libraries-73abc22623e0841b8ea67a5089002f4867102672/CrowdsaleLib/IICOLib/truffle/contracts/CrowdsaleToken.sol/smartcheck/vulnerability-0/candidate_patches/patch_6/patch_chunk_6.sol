function approve(TokenStorage storage self, address _spender, uint256 _value) public returns (bool) {
    // To mitigate the race condition,
    // the function will revert if an approval is attempted when the current allowance is not zero,
    // unless it's setting it to zero.
    require((_value == 0) || (self.allowed[msg.sender][_spender] == 0), "Cannot approve from non-zero to non-zero allowance");
    
    self.allowed[msg.sender][_spender] = _value;
    emit Approval(msg.sender, _spender, _value);
    return true;
}