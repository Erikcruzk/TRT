function finalizeSale() public returns (bool) {
    require(now >= sale.base.endTime);
    require(!sale.isFinalized); 
    require(setCanceled(sale));

    sale.isFinalized = true;
    require(launchToken(sale));
    
    uint256 computedValue;

    if(!sale.isCanceled){
      if(sale.totalValuation == sale.currentBucket){
        
        sale.q = (100*(sale.valueCommitted - sale.totalValuation)/(sale.valuationSums[sale.totalValuation])) + 1;
        computedValue = sale.valueCommitted - sale.valuationSums[sale.totalValuation];
        computedValue += (sale.q * sale.valuationSums[sale.totalValuation])/100;
      } else {
        
        computedValue = sale.totalValuation;
      }
      sale.base.ownerBalance = computedValue;  
    }
  }