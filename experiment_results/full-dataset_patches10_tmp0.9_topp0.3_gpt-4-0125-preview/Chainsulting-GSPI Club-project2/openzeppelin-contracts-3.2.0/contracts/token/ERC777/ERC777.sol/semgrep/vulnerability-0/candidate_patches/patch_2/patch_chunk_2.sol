function _callTokensReceived(
    address operator,
    address from,
    address to,
    uint256 amount,
    bytes memory userData,
    bytes memory operatorData,
    bool requireReceptionAck
)
    private
{
    address implementer = _ERC1820_REGISTRY.getInterfaceImplementer(to, _TOKENS_RECIPIENT_INTERFACE_HASH);
    if (implementer != address(0)) {
        // Ensure this call does not allow for reentrancy
        uint256 balanceBefore = balanceOf(to);
        IERC777Recipient(implementer).tokensReceived(operator, from, to, amount, userData, operatorData);
        require(balanceOf(to) == balanceBefore.add(amount), "ERC777: tokensReceived call did not properly update balance");
    } else if (requireReceptionAck) {
        require(!to.isContract(), "ERC777: token recipient contract has no implementer for ERC777TokensRecipient");
    }
}