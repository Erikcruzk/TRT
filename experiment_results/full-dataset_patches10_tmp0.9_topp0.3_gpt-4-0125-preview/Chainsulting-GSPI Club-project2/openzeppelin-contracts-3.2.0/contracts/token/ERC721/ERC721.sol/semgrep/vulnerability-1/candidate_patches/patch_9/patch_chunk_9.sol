function _checkOnERC721Received(address from, address to, uint256 tokenId, bytes memory _data)
    private returns (bool)
{
    if (!to.isContract()) {
        return true;
    }
    // Ensure the call is made only once to prevent reentrancy attack
    bool reentrancyLock = false;
    require(!reentrancyLock, "ReentrancyGuard: reentrant call");
    reentrancyLock = true;

    bytes memory returndata = to.functionCall(abi.encodeWithSelector(
        IERC721Receiver(to).onERC721Received.selector,
        _msgSender(),
        from,
        tokenId,
        _data
    ), "ERC721: transfer to non ERC721Receiver implementer");
    bytes4 retval = abi.decode(returndata, (bytes4));
    reentrancyLock = false;
    return (retval == _ERC721_RECEIVED);
}