function _upgradeRelayHub(address newRelayHub) internal virtual {
    address currentRelayHub = _relayHub;
    require(newRelayHub != address(0), "GSNRecipient: new RelayHub is the zero address");
    require(newRelayHub != currentRelayHub, "GSNRecipient: new RelayHub is the current one");

    // Withdraw all funds from the current RelayHub before upgrading
    uint256 balance = IRelayHub(currentRelayHub).balanceOf(address(this));
    if (balance > 0) {
        IRelayHub(currentRelayHub).withdraw(balance, payable(address(this)));
    }

    emit RelayHubChanged(currentRelayHub, newRelayHub);

    _relayHub = newRelayHub;
}