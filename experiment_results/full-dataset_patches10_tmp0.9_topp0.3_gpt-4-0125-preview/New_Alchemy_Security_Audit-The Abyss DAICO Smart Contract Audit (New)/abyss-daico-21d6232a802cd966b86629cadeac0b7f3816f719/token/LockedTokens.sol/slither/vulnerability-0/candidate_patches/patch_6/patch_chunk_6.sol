function releaseTokens() public {
    uint256 length = walletTokens[msg.sender].length;
    require(length > 0);
    uint256 amountToSend = 0;

    for(uint256 i = 0; i < length; i++) {
        if(!walletTokens[msg.sender][i].released && now >= walletTokens[msg.sender][i].lockEndTime) {
            walletTokens[msg.sender][i].released = true;
            amountToSend = safeAdd(amountToSend, walletTokens[msg.sender][i].amount);
            TokensUnlocked(msg.sender, walletTokens[msg.sender][i].amount);
        }
    }
    if(amountToSend > 0) {
        token.transfer(msg.sender, amountToSend);
    }
}