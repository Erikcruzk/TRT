function approve(address spender, uint256 amount) public virtual override returns (bool) {
    address owner = _msgSender();
    require(owner != address(0), "ERC20: approve from the zero address");
    require(spender != address(0), "ERC20: approve to the zero address");

    // Vulnerability fix: To prevent race condition in approve function, first set the allowance to zero
    // and then update the value afterwards if and only if the previous allowance is zero
    // or the amount being set is zero. This is to mitigate the potential race condition described
    // in EIP-20.
    uint256 currentAllowance = _allowances[owner][spender];
    if (currentAllowance != 0 && amount != 0) {
        revert("ERC20: approve non-zero to non-zero allowance");
    }

    _allowances[owner][spender] = amount;
    emit Approval(owner, spender, amount);
    return true;
}