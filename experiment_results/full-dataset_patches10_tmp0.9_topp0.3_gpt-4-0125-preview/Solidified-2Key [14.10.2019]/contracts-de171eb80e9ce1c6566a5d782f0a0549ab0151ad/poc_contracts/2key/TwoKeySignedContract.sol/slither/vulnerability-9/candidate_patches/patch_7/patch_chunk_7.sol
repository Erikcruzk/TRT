function buyFrom(address _from) public payable {
    _from = plasmaOf(_from);

    address _to = senderPlasma();

    // Ensure that a user cannot call buyFrom on his own account and bypass reentrancy check
    require(_from != _to, "Cannot buy from yourself");

    if (balanceOf(_to) == 0) {
        transferFromInternal(_from, _to, 1);
    }

    // Reentrancy vulnerability fixed by moving buyProduct() inside the condition
    // This ensures that the state change (transferFromInternal) completes before external calls
    buyProduct();
}