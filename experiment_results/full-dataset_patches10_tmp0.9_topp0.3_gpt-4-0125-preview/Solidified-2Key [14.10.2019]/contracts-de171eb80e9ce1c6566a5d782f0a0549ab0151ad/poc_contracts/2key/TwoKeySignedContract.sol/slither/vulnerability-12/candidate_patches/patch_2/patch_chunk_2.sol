function buyProduct() public payable {
    uint _units = msg.value.div(cost);
    require(msg.value == cost * _units, "ethere sent does not divide equally into units");
    
    // Calculate bounty for the units being bought
    uint256 _bounty = bounty.mul(_units);

    // Use a local variable to store updated state before making an external call
    uint256 updated_total_units = _total_units.sub(_units);

    // External call to a function that modifies contract state should be made after all changes to state variables
    buyProductInternal(_units, _bounty);

    // Update the state variable after the external call
    _total_units = updated_total_units;
}