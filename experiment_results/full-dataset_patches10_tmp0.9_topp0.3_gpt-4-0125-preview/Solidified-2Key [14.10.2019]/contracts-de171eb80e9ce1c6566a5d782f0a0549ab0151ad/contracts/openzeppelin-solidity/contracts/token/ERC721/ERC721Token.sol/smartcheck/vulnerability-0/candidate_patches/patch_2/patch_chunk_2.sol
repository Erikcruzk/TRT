function removeTokenFrom(address _from, uint256 _tokenId) internal {
    require(ownerOf(_tokenId) == _from);
    ownedTokensCount[_from] = ownedTokensCount[_from].sub(1);
    tokenOwner[_tokenId] = address(0);

    // Correct way to manage tokens to avoid the vulnerability
    uint256 lastTokenIndex = ownedTokens[_from].length.sub(1);
    uint256 tokenIndex = ownedTokensIndex[_tokenId];
    if (tokenIndex != lastTokenIndex) {
        uint256 lastTokenId = ownedTokens[_from][lastTokenIndex];
        ownedTokens[_from][tokenIndex] = lastTokenId; // Move the last token to the slot of the to-delete token
        ownedTokensIndex[lastTokenId] = tokenIndex; // Update the moved token's index
    }
    ownedTokens[_from].length--;
    delete ownedTokensIndex[_tokenId]; // Technically not necessary, but cleans up state
}