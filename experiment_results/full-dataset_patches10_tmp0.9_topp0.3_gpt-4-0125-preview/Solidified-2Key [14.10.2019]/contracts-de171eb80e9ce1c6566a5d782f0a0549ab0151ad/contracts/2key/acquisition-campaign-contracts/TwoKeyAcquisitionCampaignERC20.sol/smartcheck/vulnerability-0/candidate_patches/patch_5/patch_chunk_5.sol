function buyTokensAndDistributeReferrerRewards(
    uint256 _maxReferralRewardETHWei,
    address _converter,
    uint _conversionId,
    bool _isConversionFiat
)
public
onlyTwoKeyConversionHandler
returns (uint)
{
    
    uint totalBounty2keys;
    
    if(maxReferralRewardPercent > 0) {
        if(_isConversionFiat) {
            address upgradableExchange = getContractProxyAddress("TwoKeyUpgradableExchange");
            uint rate = IUpgradableExchange(upgradableExchange).sellRate2key();
            totalBounty2keys = _maxReferralRewardETHWei.mul(1000).div(rate); 
            
        } else {
            
            totalBounty2keys = buyTokensFromUpgradableExchange(_maxReferralRewardETHWei, address(this));
        }
        
        
        ITwoKeyAcquisitionLogicHandler(twoKeyAcquisitionLogicHandler).updateRefchainRewards(
            _maxReferralRewardETHWei,
            _converter,
            _conversionId,
            totalBounty2keys);
    }
    return totalBounty2keys;
}