function buyTokensAndDistributeReferrerRewards(
        uint256 _maxReferralRewardETHWei,
        address _converter,
        uint _conversionId
    )
    public
    returns (uint)
    {
        require(msg.sender == twoKeyDonationConversionHandler);
        
        uint totalBounty2keys;
        
        if(maxReferralRewardPercent > 0) {
            // Ensuring no state changes happen until all require statements pass and calculations are done
            uint256 calculatedBounty = buyTokensFromUpgradableExchange(_maxReferralRewardETHWei, address(this));
            
            ITwoKeyDonationLogicHandler(twoKeyDonationLogicHandler).updateRefchainRewards(
                _maxReferralRewardETHWei,
                _converter,
                _conversionId,
                calculatedBounty);
            
            totalBounty2keys = calculatedBounty;
        }
        reservedAmount2keyForRewards = reservedAmount2keyForRewards.add(totalBounty2keys);
        return totalBounty2keys;
    }