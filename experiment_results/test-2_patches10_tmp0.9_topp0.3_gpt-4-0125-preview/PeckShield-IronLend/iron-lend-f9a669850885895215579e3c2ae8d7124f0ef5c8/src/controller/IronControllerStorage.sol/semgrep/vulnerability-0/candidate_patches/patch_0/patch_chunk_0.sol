function doTransferOut(address payable to, uint amount) internal {
    // Keep track of the current contract's balance before the transfer
    uint256 balanceBefore = EIP20NonStandardInterface(underlying).balanceOf(address(this));

    EIP20NonStandardInterface(underlying).transfer(to, amount);

    // Check if the transfer failed
    bool success;
    assembly {
        switch returndatasize()
        case 0 {                       
            success := not(0)            
        }
        case 32 {                      
            returndatacopy(0, 0, 32)
            success := mload(0)         
        }
        default {                      
            revert(0, 0)
        }
    }
    require(success, "TOKEN_TRANSFER_OUT_FAILED");
    
    // Ensure that the balance after transfer is correct
    uint256 balanceAfter = EIP20NonStandardInterface(underlying).balanceOf(address(this));
    require(balanceBefore - balanceAfter == amount, "TOKEN_TRANSFER_OUT_AMOUNT_MISMATCH");
}