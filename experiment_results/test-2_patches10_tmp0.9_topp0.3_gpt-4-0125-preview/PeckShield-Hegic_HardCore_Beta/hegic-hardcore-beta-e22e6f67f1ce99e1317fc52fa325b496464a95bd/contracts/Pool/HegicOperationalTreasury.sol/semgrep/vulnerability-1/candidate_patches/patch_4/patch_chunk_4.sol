function _checkOnERC721Received(
    address from,
    address to,
    uint256 tokenId,
    bytes memory data
) private returns (bool) {
    if (to.isContract()) {
        (bool success, bytes memory returndata) = to.call(
            abi.encodeWithSelector(
                IERC721Receiver(to).onERC721Received.selector,
                _msgSender(),
                from,
                tokenId,
                data
            )
        );
        
        return success && (returndata.length == 0 || abi.decode(returndata, (bytes4)) == IERC721Receiver.onERC721Received.selector);
    } else {
        return true;
    }
}